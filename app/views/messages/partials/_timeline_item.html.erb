<% messages.each do |message| %>
  <% message_date = message_date(message.m_moment) %>
  <% if message_date != prev_message_date %>
    <%# timeline time label %>
    <li class="time-label">
      <span>
        <%= message_date %>
      </span>
    </li>
  <% end %>
  <%# timeline item %>
  <li data-msg-id="<%= message.id %>">
    <%# timeline icon %>
    <i class="fa fa-<%= timeline_icon(message.m_origin) %> bg-<%= message.m_origin %>">
      <%= timeline_icon_semon(message.m_origin) %>
    </i>
    <div class="timeline-item">
      <span class="time"><i class="fa fa-clock-o"></i> <%= message_time(message.m_moment) %></span>

      <h3 class="timeline-header">
        <%= link_to message_user_url(message.m_details), target: "_blank" do %>
          <%= message_user_image(message.m_details) %>
          <%= unescape_text_characters(message.m_author) %>
        <% end %>
      </h3>

      <div class="timeline-body">
        <%= message_text_with_links(message.m_text) %>
      </div>

      <div class="timeline-footer">
        <div class="row">
          <div class="col-xs-12 col-sm-11">
            <%= link_to message_url(message), title: message_url(message), target: "_blank" do %>
              <i class="fa fa-link"></i>
            <% end %>
            <i class="fa fa-tags"></i>
            <% message.tags.each do |tag| %>
              <button class="btn btn-default btn-xs disabled"><%= tag.t_name %></button>
            <% end %>
          </div>
          <div class="col-xs-12 col-sm-1">
            <%= link_to "/messages/#{message.id}", method: :delete, remote: true, data: {
                confirm: "Diese Nachricht wirklich entfernen?" }, class: "pull-right" do %>
              <i class="fa fa-trash-o text-red"></i>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </li>
  <% prev_message_date = message_date %>
<% end %>
