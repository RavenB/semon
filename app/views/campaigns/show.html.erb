<section class="content-header">
  <h1>
    <%= campaign_name(@campaign) %>
    <small>Dashboard</small>
  </h1>
  <ol class="breadcrumb">
    <li><a href="/"><i class="fa fa-th"></i> Kampagnen</a></li>
    <li class="active"><a href="#"><%= campaign_name(@campaign) %> Dashboard</a></li>
  </ol>
</section>

<section class="content">
  <div class="row">
    <div class="col-xs-12 col-sm-6">
      <%= link_to messages_path, class: "info-box bg-light-blue" do %>
        <span class="info-box-icon bg-opacity">
          <i class="ion-ios-list-outline"></i>
        </span>
        <div class="info-box-content">
          <span class="info-box-text" title="Timeline aller Beiträge">
            Timeline aller Beiträge
          </span>
          <span id="all-messages-count" class="info-box-number">
            <%= @campaign.messages.count %>
          </span>
        </div>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <div class="nav-tabs-custom">
        <ul class="nav nav-tabs">
          <li class="active">
            <%= link_to "Beiträge", "#tab_1", "data-toggle" => "tab", "aria-expanded" => "true" %>
          </li>
          <li>
            <%= link_to "Stichworte", "#tab_2", "data-toggle" => "tab", "aria-expanded" => "true" %>
          </li>
        </ul>
        <div class="tab-content">
          <div id="tab_1" class="tab-pane active">
            <div class="row">
              <%= render partial: "/campaigns/partials/chart_box_dashboard",
                         locals: {
                           title: "Beiträge pro Tag (#{campaign_date_range(@campaign)})",
                           id: "messages-in-period" } %>
              <%= render partial: "/campaigns/partials/chart_box_dashboard",
                         locals: { title: "Beitragszeitpunkte", id: "messages-at-time" } %>
              <%= render partial: "/campaigns/partials/chart_box_dashboard",
                         locals: { title: "Sentiment der Beiträge", id: "sentiment" } %>
            </div>
          </div>
          <div id="tab_2" class="tab-pane">
            <div class="row">
              <%= render partial: "/campaigns/partials/chart_box_dashboard",
                         locals: { title: "Top Stichworte der Kampagne", id: "top-tags" } %>
              <%= render partial: "/campaigns/partials/chart_box_dashboard",
                         locals: { title: "Wort-Cloud aller Beiträge", id: "word-cloud" } %>
              <%= render partial: "/campaigns/partials/chart_box_dashboard",
                         locals: {
                           title: "Wortbaum des top Stichworts",
                           id: "word-tree",
                           col: 12 } %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%#
      - darstellungen von (gefilterten) daten
      - zeiterverlauf/anzahlen in liniendiagramm
      - plattformen/anzahlen in balken- oder kreisdiagramm
      - themen/häufigkeit in tagcloud
      - topautoren/anzahl beiträge in balken- oder kreisdiagramm/tabelle
      - topseiten oder -links/anzahl beiträge in balken- oder kreisdiagramm
      - tonalität (positiv, neutral, negativ) linien-, balken- oder kreisdiagramm
    %>

    <div id="twitter-request"></div>
  </div>
</section>

<% content_for :page_script do %>
  <script type="text/jsx">
    $(function() {
      var secondTabOpended = 0;
      // init google charts
      var ajax_options = {
        dataType: 'script',
        cache: true,
        url: 'https://www.google.com/jsapi',
      };
      $.ajax(ajax_options).done(function () {
        google.load('visualization', '1.1', {
          packages:['corechart', 'wordtree'],
          callback: function() { // call all charts renderer
            messagesInPeriod();
            messagesAtTime();
            sentiment();
            twitterRequest();

            $('a[data-toggle=tab]').on('shown.bs.tab', function (e) {
              if ($(e.target).attr('href') == '#tab_2' && !secondTabOpended) {
                topTags();
                wordCloud();
                wordTree();
                secondTabOpended = 1;
              }
            });
          }
        });
      });
    });

    var FIVE_MINUTES = 5 * 60000;
    var ONE_MINUTE = 1 * 60000;
    var CHART_COLORS = [
      '#3c8dbc', '#dd4b39', '#00a65a', '#00c0ef', '#f39c12', '#605ca8', '#001F3F', '#39CCCC',
      '#3D9970', '#01FF70', '#F012BE', '#0073b7', '#D81B60', '#111111', '#FF851B', '#d2d6de'
    ];

    // react code goes here
    /** @jsx React.DOM */
    var SetIntervalMixin = {
      componentWillMount: function() {
        this.intervals = [];
      },
      setInterval: function() {
        this.intervals.push(setInterval.apply(null, arguments));
      },
      componentWillUnmount: function() {
        this.intervals.map(clearInterval);
      }
    };
  </script>

  <%= render "/dashboard/messages_in_period" %>
  <%= render "/dashboard/messages_at_time" %>
  <%= render "/dashboard/sentiment" %>
  <%= render "/dashboard/twitter_request" %>
  <%= render "/dashboard/top_tags" %>
  <%= render "/dashboard/word_cloud" %>
  <%= render "/dashboard/word_tree" %>
<% end %>
